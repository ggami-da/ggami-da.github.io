---
layout: post
title:  "[AB Test] Type 1, 2 Error, Power Analysis"
date:   2024-11-27
last_modified_at: 2024-11-27
categories: [AB Test, Statistic]
tags: [Casual Inference, Data]
---

{: .box-success}
주로 분석할 때 많이 사용하는 이론을 간략히 정리합니다.

### **1. 1종 오류(Type I Error)**

**정의**: 1종 오류는 **실제로는 귀무가설이 참(true)**인데도 불구하고, **잘못하여 귀무가설을 기각하는 오류**를 말합니다. 이는 **거짓 양성(False Positive)** 결과로도 알려져 있습니다.

**유의수준(Significance Level, $$\alpha$$)**:

- **의미**: 유의수준은 연구자가 **1종 오류를 허용하는 최대 확률**을 나타냅니다.
- **일반적인 값**: 보통 $$\alpha = 0.05$$ 또는 $$\alpha = 0.01$$과 같이 설정됩니다.
- **해석**: $$\alpha = 0.05$$이면, 실제로 효과가 없을 때(귀무가설이 참일 때) 우연에 의해 5%의 확률로 귀무가설을 잘못 기각할 가능성이 있다는 의미입니다.

**사례**:

- **의료 연구**: 새로운 치료법이 실제로 효과가 없는데도 불구하고 효과가 있다고 결론짓는 경우.
- **법률 분야**: 무고한 사람을 유죄로 판단하는 오류.

---

### **2. 2종 오류(Type II Error)**

**정의**: 2종 오류는 **실제로는 귀무가설이 거짓(false)**인데도 불구하고, **잘못하여 귀무가설을 기각하지 않는 오류**를 말합니다. 이는 **거짓 음성(False Negative)** 결과로도 알려져 있습니다.

**베타 오류 확률($$\beta$$)**:

- **의미**: 2종 오류가 발생할 확률을 나타냅니다.
- **검정력과의 관계**: $$\text{검정력} = 1 - \beta$$
- **해석**: $$\beta = 0.2$$이면, 실제로 효과가 있을 때(귀무가설이 거짓일 때) 20%의 확률로 그 효과를 발견하지 못할 수 있다는 의미입니다.

**사례**:

- **의료 연구**: 실제로 효과적인 치료법이 있는데도 효과가 없다고 결론짓는 경우.
- **법률 분야**: 실제 범죄자를 무죄로 석방하는 오류.

---

### **3. 검정력(Statistical Power)**

**정의**: 검정력은 **실제로 효과가 존재할 때(귀무가설이 거짓일 때)** 이를 **올바르게 발견하여 귀무가설을 기각할 확률**을 말합니다.

**계산식**:

$$
\text{검정력} = 1 - \beta
$$

**의의**: 검정력이 높을수록 실제 효과를 놓치지 않고 발견할 가능성이 높아집니다.

**검정력에 영향을 미치는 요인**:

1. **효과크기(Effect Size, $$\delta$$)**:
    - **의미**: 두 집단 간의 실제 차이의 크기.
    - **영향**: 효과크기가 클수록 검정력이 증가합니다.
2. **표본 크기(Sample Size, $$n$$)**:
    - **의미**: 연구에 참여하는 관측치 또는 실험 단위의 수.
    - **영향**: 표본 크기가 클수록 검정력이 증가합니다.
3. **유의수준($$\alpha$$)**:
    - **영향**: 유의수준이 높을수록(예: $$\alpha = 0.10$$) 검정력이 증가하지만, 이는 1종 오류의 가능성을 높입니다.
4. **표준편차(Standard Deviation, $$\sigma$$)**:
    - **의미**: 데이터의 변동성.
    - **영향**: 변동성이 작을수록 검정력이 증가합니다.
5. **검정 방식**:
    - **일표본, 독립표본, 대응표본 등** 검정 방법에 따라 검정력이 달라질 수 있습니다.

---

### **검정력 분석(Power Analysis)**

검정력 분석은 **연구 설계 단계에서 필요한 표본 크기를 결정하거나**, **주어진 표본 크기에서 검정력을 추정하는 과정**을 말합니다.

### **1. 사전 검정력 분석(Priori Power Analysis)**

- **의미**: 연구를 시작하기 전에 **필요한 표본 크기**를 결정하기 위해 수행합니다.
- **목적**: 원하는 검정력을 확보하여 효과를 발견할 수 있도록 합니다.
- **사용 요소**:
    - 예상되는 효과크기($$\delta$$)
    - 유의수준($$\alpha$$)
    - 원하는 검정력($$1 - \beta$$)
    - 표준편차($$\sigma$$)
- **계산식**:
    
    $$
    n = \left( \frac{Z_{1 - \alpha/2} \cdot \sigma + Z_{1 - \beta} \cdot \sigma}{\delta} \right)^2
    $$
    
    여기서,
    
    - $$n$$: 필요한 표본 크기
    - $$Z_{1 - \alpha/2}$$: 유의수준에 따른 Z-값 (양측 검정의 경우)
    - $$Z_{1 - \beta}$$: 검정력에 따른 Z-값
    - $$\delta$$: 효과크기
    - $$\sigma$$: 표준편차

### **2. 사후 검정력 분석(Post-hoc Power Analysis)**

- **의미**: 연구가 끝난 후, **수집된 데이터**를 기반으로 검정력을 계산하는 것입니다.
- **문제점**:
    - **의존성 문제**: 사후 검정력은 **실험에서 관측된 효과크기와 p-값에 의존**하므로, 결과적으로 검정력이 낮게 계산될 수 있습니다.
    - **해석의 어려움**: 사후 검정력은 **이미 관측된 데이터**를 기반으로 하므로, 추가적인 정보를 제공하지 못하고 **결과를 정당화**하는 데 사용될 수 있습니다.
    - **함정**: 사후 검정력은 실제로는 **p-값의 변환**에 불과하며, 의미 있는 해석을 하기 어렵습니다.

---

### **사전 검정력 분석과 사후 검정력 분석의 차이점**

|  | **사전 검정력 분석** | **사후 검정력 분석** |
| --- | --- | --- |
| **시점** | 연구 **시작 전** | 연구 **종료 후** |
| **목적** | 필요한 **표본 크기 결정** 또는 원하는 검정력 확보 | **관측된 데이터**로부터 검정력 추정 |
| **사용 데이터** | 예상되는 효과크기, 표준편차 등 **사전 정보** | **실험에서 관측된 데이터** |
| **의의** | 연구 설계에 필수적이며, **미리 준비된 검정력** | 결과 해석에 도움이 되지 않으며, **오해를 일으킬 수 있음** |

---

### **사후 검정력 분석의 문제점 상세 설명**

### **1. 사후 검정력은 p-값의 변환에 불과함**

- 사후 검정력은 관측된 효과크기와 표본 크기를 기반으로 계산되는데, 이는 이미 계산된 p-값을 다른 형태로 표현한 것에 지나지 않습니다.
- 따라서 사후 검정력은 **추가적인 정보를 제공하지 않으며**, 이미 얻은 결과를 재해석하는 데 큰 도움이 되지 않습니다.

### **2. 낮은 검정력과 비유의성**

- 연구에서 통계적으로 유의미한 결과를 얻지 못했을 때, 사후 검정력이 낮게 계산되는 것은 당연한 결과입니다.
- 이는 실제로 효과가 없어서가 아니라, 단순히 표본 크기가 충분하지 않아서 일 수 있습니다.
- 하지만 사후 검정력 분석은 이러한 해석을 명확하게 제공하지 못합니다.

### **3. 효과크기의 불확정성**

- 관측된 효과크기는 표본 변동성에 크게 영향을 받습니다.
- 특히 표본 크기가 작은 경우, 관측된 효과크기는 실제 효과크기와 크게 다를 수 있습니다.
- 이러한 불안정한 값을 기반으로 한 사후 검정력은 신뢰성이 낮습니다.

### **4. 대안적 접근법의 필요성**

- 효과크기와 신뢰구간을 보고하여 결과를 해석하는 것이 더 유용합니다.
- **신뢰구간**은 효과크기의 불확실성을 나타내므로, 결과 해석에 도움이 됩니다.

---

### **사후 검정력 분석의 문제점 예시**

### **예시 상황**

- 한 연구자가 신약의 효과를 검증하기 위해 임상시험을 진행했습니다.
- 표본 크기는 30명(실험군 15명, 대조군 15명)입니다.
- 실험 결과, 두 그룹 간 평균 차이는 통계적으로 유의하지 않았습니다(p-value > 0.05).

### **연구자가 사후 검정력 분석을 실시**

1. **관측된 데이터로부터 효과크기 계산**:
    - 평균 차이: $$\overline{X}_1 - \overline{X}*2 = \delta*{\text{obs}}$$
    - 표준오차(SE): $$SE = \sqrt{\frac{2\sigma^2}{n}}$$
2. **사후 검정력 계산**:
    - 검정력: $$1 - \beta = \Phi\left( \frac{\delta_{\text{obs}}}{SE} - Z_{1 - \alpha/2} \right)$$
    - 여기서 $$\Phi$$는 표준 정규 분포의 누적 분포 함수(CDF)입니다.
3. **결과 해석**:
    - 검정력이 낮게 나왔다면(예: 30%), 이는 표본 크기가 작아서 효과를 발견하지 못했다는 결론을 내릴 수 있습니다.

### **문제점 분석**

- **불안정한 효과크기**: 작은 표본으로 인해 관측된 효과크기가 실제 효과를 반영하지 못할 수 있습니다.
- **p-값의 재해석**: 사후 검정력은 p-값과 밀접한 관련이 있으므로, 새로운 정보를 제공하지 않습니다.
- **의사결정의 지연**: 사후 검정력에 의존하면 잘못된 결론에 도달할 수 있으며, 추가 연구의 필요성을 오도할 수 있습니다.

---

### **R 코드를 통한 예시**

### **1. 사후 검정력 분석의 잘못된 사용**

```R
set.seed(123)
n <- 15
group1 <- rnorm(n, mean = 100, sd = 15)
group2 <- rnorm(n, mean = 105, sd = 15)

# t-검정 수행
test_result <- t.test(group1, group2, var.equal = TRUE)
print(test_result)
```

**t-검정 결과 해석**:

- p-value가 0.2로 유의수준 0.05보다 크므로, 귀무가설을 기각하지 못합니다.

### **사후 검정력 계산**

```R
# 효과크기 계산(Cohen's d)
library(effsize)
effect_size <- cohen.d(group1, group2, pooled=TRUE)$estimate
print(effect_size)

# 사후 검정력 계산
library(pwr)
power_result <- pwr.t.test(n = n, d = effect_size, sig.level = 0.05, type = "two.sample", alternative = "two.sided")
print(power_result)
```

**사후 검정력 결과**:

- 검정력이 약 30%로 낮게 나옵니다.
- 이를 근거로 "검정력이 낮아서 효과를 발견하지 못했다"고 결론짓는 것은 문제가 있습니다.

### **문제점 정리**

- **효과크기의 불안정성**: 작은 표본 크기로 계산된 효과크기는 신뢰할 수 없습니다.
- **결과의 순환성**: 사후 검정력은 이미 얻은 p-값의 다른 표현일 뿐입니다.

---

### **올바른 접근법: 사전 검정력 분석**

### **1. 예상되는 효과크기와 표준편차 기반으로 표본 크기 결정**

- 예를 들어, 효과크기 $$\delta = 5$$ (5점 차이)를 검출하고자 함.
- 표준편차 $$\sigma = 15$$, 유의수준 $$\alpha = 0.05$$, 검정력 $$1 - \beta = 0.8$$.

### **계산식**

$$
n = \left( \frac{Z_{1 - \alpha/2} \cdot \sigma + Z_{1 - \beta} \cdot \sigma}{\delta} \right)^2
$$

- $$Z_{1 - \alpha/2} = 1.96$$ (유의수준 0.05)
- $$Z_{1 - \beta} = 0.84$$ (검정력 80%)

$$
n = \left( \frac{1.96 \times 15 + 0.84 \times 15}{5} \right)^2 = \left( \frac{42 + 12.6}{5} \right)^2 = \left( \frac{54.6}{5} \right)^2 = (10.92)^2 = 119.26
$$

- 따라서, 각 그룹에 **약 120명의 표본**이 필요합니다.


```R
library(pwr)
power_calculation <- pwr.t.test(d = 5/15, sig.level = 0.05, power = 0.8, type = "two.sample", alternative = "two.sided")
print(power_calculation)

```

**결과**:

- 각 그룹에 필요한 표본 크기가 약 120명으로 계산됩니다.

---


### **참고 문헌**

- Cohen, J. (1988). *Statistical Power Analysis for the Behavioral Sciences* (2nd ed.). Lawrence Erlbaum Associates.
- Hoenig, J. M., & Heisey, D. M. (2001). "The Abuse of Power: The Pervasive Fallacy of Power Calculations for Data Analysis." *The American Statistician*, 55(1), 19–24.
- Gelman, A., & Hill, J. (2007). *Data Analysis Using Regression and Multilevel/Hierarchical Models*. Cambridge University Press.
- Lenth, R. V. (2001). "Some Practical Guidelines for Effective Sample Size Determination." *The American Statistician*, 55(3), 187–193.
- Nakagawa, S., & Cuthill, I. C. (2007). "Effect size, confidence interval and statistical significance: a practical guide for biologists." *Biological Reviews*, 82(4), 591–605.

---