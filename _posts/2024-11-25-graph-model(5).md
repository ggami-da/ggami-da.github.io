---
layout: post
title:  "[Casual Inference] Graph Model - Confounder"
date:   2024-11-28
last_modified_at: 2024-11-28
categories: [Casual Inference]
tags: [Casual Inference, Data]
---

{: .box-success}
주로 분석할 때 많이 사용하는 모델 이론을 간략히 정리합니다.


## **혼동자(confounder)의 정의와 혼동을 나타내는 DAG**

먼저, 혼동자의 비공식적인 정의를 떠올려봅시다:

- **혼동자**는 **처리(Treatment, A)**와 **결과(Outcome, Y)** 모두에 영향을 미치는 변수입니다.

아래는 혼동을 나타내는 간단한 **방향성 비순환 그래프(DAG)**입니다.

![img.png](../../../../img/graph-model(14).png)

그림을 설명하면 다음과 같습니다. 

- **X**는 **혼동 변수**로서, **A**와 **Y** 모두에 영향을 미칩니다.
- **A**는 **Y**에 직접적인 영향을 줍니다.
- 이 그래프에서 **Backdoor 경로**는 **A ← X → Y**로 나타납니다.

---

### **Backdoor 경로와 차단의 필요성**

**Backdoor 경로**는 **처리 A**와 **결과 Y** 사이의 **비인과적 경로**입니다. 이 경로는 혼동을 일으켜 **A**와 **Y** 사이의 관계를 왜곡시킬 수 있습니다. 즉, **A**의 실제 효과를 정확하게 추정하는 데 방해가 됩니다.

**Backdoor 경로를 차단하기 위해서는 혼동 변수 X를 통제해야 합니다.** 이렇게 하면 **A**와 **Y** 사이의 비인과적 연관성을 제거하고, **A**의 **순수한 인과적 효과**를 파악할 수 있습니다.

**Backdoor 경로를 차단한 DAG는 다음과 같습니다.**

![img.png](../../../../img/graph-model(15).png)

그림을 설명하면 다음과 같습니다. 

- **혼동 변수 X를 통제하여 Backdoor 경로를 차단**했습니다.
- **X에서 A와 Y로 향하는 화살표**를 **점선**으로 변경하고, 화살표에 **'X' 표시**를 하여 **차단됨**을 나타냈습니다.
- 이제 **A**와 **Y** 사이의 **직접적인 인과 경로**만 남았습니다.

---

### **Frontdoor 경로와 그 중요성**

**Frontdoor 경로**는 **처리 A**에서 시작하여 **결과 Y**로 향하는 **인과적 경로**입니다. 이 경로는 우리가 관심 있는 **처리의 효과**를 나타내므로 **차단하면 안 됩니다.**

**예시 1: A가 Y에 직접 영향을 미치는 경우**

![img.png](../../../../img/graph-model(16).png)

그림을 설명하면 다음과 같습니다. 

- **A**는 **Y**에 **직접적인 인과 영향**을 미칩니다.
- 이 경우, **Frontdoor 경로**는 **A → Y**입니다.

**예시 2: A가 Z를 통해 Y에 영향을 미치는 경우**

![img.png](../../../../img/graph-model(17).png)

그림을 설명하면 다음과 같습니다. 

- **A**는 **Z**에 영향을 미치고, **Z**는 **Y**에 영향을 미칩니다.
- **Frontdoor 경로**는 **A → Z → Y**로 나타납니다.
- **Z**는 **중간 변수(Mediator)**로서, **A**의 효과가 **Y**로 전달되는 경로입니다.

---

### **Backdoor 경로를 차단해야 하는 이유**

**Backdoor 경로**는 **A**와 **Y** 사이의 **비인과적 연관성**을 만들어냅니다. 이는 **A**의 효과를 정확하게 추정하는 데 방해가 됩니다. **혼동 변수 X를 통제하여 Backdoor 경로를 차단하면**, 다음과 같은 이점이 있습니다:

- **A**와 **Y** 사이의 **진정한 인과 관계**를 파악할 수 있습니다.
- **A**는 **잠재적 결과와 독립적**이 되어 **'무시 가능성(ignorability)'** 조건을 만족합니다.
- **처리 효과를 정확하게 추정**할 수 있습니다.

---

### **복잡한 혼동 상황의 예시**

다음은 혼동의 복잡한 상황을 나타내는 DAG입니다.

![img.png](../../../../img/graph-model(18).png)

**설명:**

- **V**는 **A**에 직접 영향을 미칩니다 (**V → A**).
- **V**는 **W**를 통해 **Y**에 간접적으로 영향을 미칩니다 (**V → W → Y**).
- 이 경우, **V**는 **A**와 **Y** 모두에 영향을 미치는 **혼동자**입니다.
- **Backdoor 경로**는 **A ← V → W → Y**로 나타납니다.
- **Backdoor 경로를 차단하기 위해서는 혼동 변수 V를 통제해야 합니다.**

---

### **Frontdoor 경로를 차단하면 안 되는 이유**

**Frontdoor 경로**는 **A**의 **인과적 효과**를 나타내므로 **차단하면 안 됩니다.** 특히, **중간 변수 Z**를 통제하면 **A**의 일부 효과를 제거하게 되어 **총 효과를 정확히 추정할 수 없습니다.**

**예시: A가 Z를 통해 Y에 영향을 미치고 직접적인 영향도 있는 경우**

![img.png](../../../../img/graph-model(19).png)

**설명:**

- **A**는 **Y**에 **직접적인 영향**을 미칩니다 (**A → Y**).
- 동시에, **A**는 **Z**를 통해 **Y**에 **간접적인 영향**도 미칩니다 (**A → Z → Y**).
- **중간 변수 Z를 통제하면**, **A**가 **Y**에 미치는 **간접 효과**를 제거하게 되어 **총 효과를 정확히 추정할 수 없습니다.**
- 따라서 **Frontdoor 경로에 있는 중간 변수는 통제하지 않아야 합니다.**

---

### **인과 매개 분석(Causal Mediation Analysis)**

**처리 A가 중간 변수 Z를 통해 결과 Y에 어떻게 영향을 미치는지에 관심이 있는 경우**, 이는 **인과 매개 분석**으로 알려져 있습니다.

- **인과 매개 분석**은 **처리 효과를 직접 효과와 간접 효과로 분해**하여 각각을 정량화합니다.
- 이 분석에서는 **중간 변수 Z를 통제하지 않고**, **A → Z → Y** 경로의 **간접 효과**를 측정합니다.
- **총 효과**는 **직접 효과**와 **간접 효과**의 합으로 계산됩니다.

**하지만 일반적인 상황에서는 우리의 주요 목표는 다음과 같습니다:**

- **처리 A가 결과 Y에 얼마나 영향을 미치는지 알아내는 것**
- **그 영향이 어떤 메커니즘을 통해 발생하는지는 필수적이지 않을 수 있습니다.**

따라서 **Frontdoor 경로의 중간 변수를 통제하지 않고**, **A와 Y 사이의 총 효과**를 추정하는 것이 일반적입니다.

---

## Ref
- https://www.coursera.org/learn/crash-course-in-causality